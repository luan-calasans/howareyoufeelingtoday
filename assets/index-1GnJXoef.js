import{h as S,d as W,e as v,u as G,a as J,g as X,r as h,j as r,L as Z,B as g,C as L,I as _,m as ee,T as R}from"./index-sibPW-u2.js";import{o as A,l as f,s as o,m as C,p as w,q as F,r as O,k as re,u as T,E as te,c as se,f as E,g as ae}from"./date-DeCHnAat.js";import{T as ne,M as $}from"./Toast-D4hO9sXq.js";const j=A({id:o().min(1),entryId:f([o(),w("")]).optional().transform(e=>e===""||!e?void 0:e),date:f([o(),C()]).transform(e=>{if(!e)return"";if(typeof e=="object"&&e!==null&&"getFullYear"in e){const s=e,c=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${c}-${n}-${a}`}const t=String(e).trim();if(t&&t!==""){const s=new Date(t);if(!isNaN(s.getTime())){const c=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${c}-${n}-${a}`}if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t}return t}),user:o().min(1),request:o().min(1,"Pedido de oração é obrigatório"),status:f([O(["pending","answered","archived"]),w(""),o()]).transform(e=>{if(!e||e==="")return"pending";const t=String(e).toLowerCase().trim();return["pending","answered","archived"].includes(t)?t:"pending"}).default("pending"),answeredDate:f([o(),w(""),F()]).optional().transform(e=>e===""||!e?void 0:e),answer:f([o(),w(""),F()]).optional().transform(e=>e===""||!e?void 0:e),createdAt:f([o(),C()]).transform(e=>typeof e=="object"&&e!==null&&"toISOString"in e&&typeof e.toISOString=="function"?e.toISOString():String(e||"")),updatedAt:f([o(),C()]).transform(e=>typeof e=="object"&&e!==null&&"toISOString"in e&&typeof e.toISOString=="function"?e.toISOString():String(e||""))}).transform(e=>({...e,entryId:e.entryId===""||!e.entryId?void 0:e.entryId,answeredDate:e.answeredDate===""||!e.answeredDate?void 0:e.answeredDate,answer:e.answer===""||!e.answer?void 0:e.answer}));A({entryId:o().optional(),date:o().regex(/^\d{4}-\d{2}-\d{2}$/),user:o(),request:o().min(1,"Pedido de oração é obrigatório")});A({status:O(["pending","answered","archived"]).optional(),answeredDate:o().optional(),answer:o().optional()});async function ie(e={}){const t={action:"getPrayers"};e.status&&e.status.trim()!==""&&(t.status=e.status),e.user&&e.user.trim()!==""&&(t.user=e.user);const s=await S.get("",{params:t,includeAccessKeyInParams:!0});if(!s.ok)throw new Error(s.error||"Failed to fetch prayers");if(!s.data)return[];if(!Array.isArray(s.data))return[];if(s.data.length===0)return[];const c=re(j);try{const n=c.safeParse(s.data);if(n.success)return n.data;const a=[];for(const d of s.data){if(!d||typeof d!="object")continue;const u=j.safeParse(d);u.success&&a.push(u.data)}return a}catch(n){return console.error("Error parsing prayers:",n),[]}}async function oe(e){const t=await S.post("",e,{params:{action:"createPrayer"},includeAccessKeyInParams:!0});if(!t.ok||!t.data)throw new Error(t.error||"Failed to create prayer request");return j.parse(t.data)}async function ce(e,t){const s=await S.post("",t,{params:{action:"updatePrayer",id:e},includeAccessKeyInParams:!0});if(!s.ok||!s.data)throw new Error(s.error||"Failed to update prayer request");return j.parse(s.data)}async function de(e){const t=await S.post("",{},{params:{action:"deletePrayer",id:e},includeAccessKeyInParams:!0});if(!t.ok)throw new Error(t.error||"Failed to delete prayer request")}function ue(e={}){return W({queryKey:["prayers",e],queryFn:()=>ie(e)})}function le(){const e=v();return T({mutationFn:t=>oe(t),onSuccess:()=>{e.invalidateQueries({queryKey:["prayers"],refetchType:"active"})}})}function me(){const e=v();return T({mutationFn:({id:t,data:s})=>ce(t,s),onSuccess:()=>{e.invalidateQueries({queryKey:["prayers"],refetchType:"active"})}})}function ye(){const e=v();return T({mutationFn:t=>de(t),onSuccess:()=>{e.invalidateQueries({queryKey:["prayers"],refetchType:"active"})}})}function je(){const{user:e}=G(),{t}=J(),{partner1Name:s,partner2Name:c}=X(),[n,a]=h.useState(""),[d,u]=h.useState(!1),[y,p]=h.useState(!1),[b,P]=h.useState(null),[K,x]=h.useState(!1),{data:q,isLoading:Q,isError:B,error:D,refetch:Y}=ue({}),I=le(),k=me(),z=ye(),M=i=>i==="Partner 1"?s:i==="Partner 2"?c:i,N=(q==null?void 0:q.filter(i=>{var m;if(!n.trim())return!0;const l=n.toLowerCase();return i.request.toLowerCase().includes(l)||((m=i.answer)==null?void 0:m.toLowerCase().includes(l))||i.user.toLowerCase().includes(l)||M(i.user).toLowerCase().includes(l)||i.date.includes(l)}))||[],U=async(i,l)=>{if(e)try{await I.mutateAsync({date:ae(),user:e,request:i,entryId:l}),u(!1),x(!0),await Y(),setTimeout(()=>x(!1),3e3)}catch(m){console.error("Failed to create prayer:",m)}},V=async(i,l)=>{try{await k.mutateAsync({id:i.id,data:{status:"answered",answer:l,answeredDate:new Date().toISOString()}}),p(!1),P(null),x(!0),setTimeout(()=>x(!1),3e3)}catch(m){console.error("Failed to update prayer:",m)}},H=async i=>{if(confirm(t("confirmDeleteMessage")))try{await z.mutateAsync(i)}catch(l){console.error("Failed to delete prayer:",l)}};return Q?r.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:r.jsx(Z,{})}):B?r.jsx(te,{message:D instanceof Error?D.message:t("failedToLoad")}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:t("prayers")}),r.jsx("p",{className:"text-gray-600 mt-1",children:t("prayerReminderMessage")})]}),r.jsx(g,{onClick:()=>u(!0),children:t("createPrayerRequest")})]}),r.jsx(L,{children:r.jsx(_,{type:"text",placeholder:t("searchPrayers")||"Buscar orações...",value:n,onChange:i=>a(i.target.value),className:"w-full"})}),!N||N.length===0?r.jsx(se,{message:t("noPrayersFound")}):r.jsx("div",{className:"grid gap-4",children:N.map((i,l)=>r.jsx(pe,{prayer:i,index:l,translateUser:M,onMarkAsAnswered:m=>{P(m),p(!0)},onDelete:H,t},i.id))}),r.jsx(fe,{isOpen:d,onClose:()=>u(!1),onSubmit:U,isLoading:I.isPending,t}),b&&r.jsx(he,{isOpen:y,onClose:()=>{p(!1),P(null)},prayer:b,onSubmit:i=>V(b,i),isLoading:k.isPending,t}),r.jsx(ne,{isOpen:K,onClose:()=>x(!1),message:t("entryCreated"),type:"success"})]})}function pe({prayer:e,index:t,translateUser:s,onMarkAsAnswered:c,onDelete:n,t:a}){const d=u=>{switch(u){case"answered":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"archived":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return r.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},children:r.jsxs(L,{children:[r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:s(e.user)}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${d(e.status)}`,children:a(e.status)})]}),r.jsx("p",{className:"text-sm text-gray-600",children:E(e.date)})]}),r.jsx("button",{onClick:()=>n(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors","aria-label":a("deleteEntry"),children:r.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),r.jsx("div",{className:"mb-4",children:r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.request})}),e.status==="answered"&&e.answer&&r.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border border-green-200",children:[r.jsxs("p",{className:"text-sm font-medium text-green-900 mb-1",children:[a("prayerAnswer"),":"]}),r.jsx("p",{className:"text-sm text-green-800 whitespace-pre-wrap",children:e.answer}),e.answeredDate&&r.jsxs("p",{className:"text-xs text-green-600 mt-2",children:[a("answeredDate"),":"," ",E(e.answeredDate.split("T")[0])]})]}),e.status==="pending"&&r.jsx("div",{className:"mt-4",children:r.jsx(g,{variant:"outline",size:"sm",onClick:()=>c(e),children:a("markAsAnswered")})})]})})}function fe({isOpen:e,onClose:t,onSubmit:s,isLoading:c,t:n}){const[a,d]=h.useState(""),u=y=>{y.preventDefault(),a.trim()&&(s(a.trim()),d(""))};return r.jsx($,{isOpen:e,onClose:t,title:n("createPrayerRequest"),children:r.jsxs("form",{onSubmit:u,className:"space-y-4",children:[r.jsx(R,{label:n("prayerRequest"),value:a,onChange:y=>d(y.target.value),placeholder:n("prayerRequestPlaceholder"),rows:5,required:!0}),r.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4",children:[r.jsx(g,{type:"button",variant:"outline",onClick:t,disabled:c,children:n("cancel")}),r.jsx(g,{type:"submit",isLoading:c,disabled:c,children:n("saveEntry")})]})]})})}function he({isOpen:e,onClose:t,prayer:s,onSubmit:c,isLoading:n,t:a}){const[d,u]=h.useState(""),y=p=>{p.preventDefault(),d.trim()&&(c(d.trim()),u(""))};return r.jsx($,{isOpen:e,onClose:t,title:a("markAsAnswered"),children:r.jsxs("form",{onSubmit:y,className:"space-y-4",children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:[a("prayerRequest"),":"]}),r.jsx("p",{className:"text-gray-600 text-sm",children:s.request})]}),r.jsx(R,{label:a("prayerAnswer"),value:d,onChange:p=>u(p.target.value),placeholder:a("prayerRequestPlaceholder"),rows:5,required:!0}),r.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4",children:[r.jsx(g,{type:"button",variant:"outline",onClick:t,disabled:n,children:a("cancel")}),r.jsx(g,{type:"submit",isLoading:n,disabled:n,children:a("confirm")})]})]})})}export{je as PrayersPage,le as useCreatePrayer,ye as useDeletePrayer,ue as usePrayers,me as useUpdatePrayer};

import{u as ne,a as B,r as i,j as e,I,S as W,T as V,B as y,m as _,g as Z,C as q,L as le}from"./index-sibPW-u2.js";import{M as H,T as Q}from"./Toast-D4hO9sXq.js";import{u as oe,M as A,C as O,c as ie,a as X,b as de}from"./useEntries-s0_UwTTe.js";import{g as z,Z as ce,a as me,f as U,b as xe,E as ue,c as ge}from"./date-DeCHnAat.js";function he({isOpen:a,onClose:m}){const{user:h}=ne(),s=oe(),{t}=B(),[u,d]=i.useState(z()),[o,p]=i.useState(""),[g,c]=i.useState(A[0]),[b,w]=i.useState(""),[x,P]=i.useState(""),[M,n]=i.useState(3),[v,N]=i.useState(""),[C,$]=i.useState(""),[S,F]=i.useState(""),[D,k]=i.useState({}),[T,j]=i.useState(!1),[E,R]=i.useState(!1);i.useEffect(()=>{p(G(u))},[]),i.useEffect(()=>{if(s.isSuccess){R(!1),m(),j(!0);const r=setTimeout(()=>{j(!1)},1600);return()=>clearTimeout(r)}},[s.isSuccess,m]),i.useEffect(()=>{if(!a){const r=setTimeout(()=>{const l=z();d(l),p(G(l)),c(A[0]),w(""),P(""),n(3),N(""),$(""),F(""),k({}),R(!1),s.reset()},100);return()=>clearTimeout(r)}},[a]);const G=r=>{const[l,f,L]=r.split("-");return`${L}/${f}/${l}`},Y=r=>{const l=r.replace(/\D/g,"");if(l.length===8){const f=l.substring(0,2),L=l.substring(2,4);return`${l.substring(4,8)}-${L}-${f}`}return u},ee=r=>{let l=r.target.value.replace(/\D/g,"");if(l.length>=2&&(l=l.substring(0,2)+"/"+l.substring(2)),l.length>=5&&(l=l.substring(0,5)+"/"+l.substring(5,9)),p(l),l.length===10){const f=Y(l);d(f)}},se=async r=>{if(r.preventDefault(),k({}),g===O&&!b.trim()){k({customMood:t("moodCustomRequired")});return}R(!0)},te=async()=>{if(h)try{const r=g===O?b.trim():g,l=ie.parse({date:u,user:h,mood:r,moodDetail:x.trim(),intensity:M,note:v.trim(),gratitude:C.trim(),prayerRequest:S.trim()});await s.mutateAsync(l)}catch(r){if(r instanceof ce){const l={};r.errors.forEach(f=>{f.path[0]&&(l[f.path[0].toString()]=f.message)}),k(l),R(!1)}}},ae=[...A.map(r=>({value:r,label:t(`moods.${r}`)})),{value:O,label:t("moodOther")}],re=[1,2,3,4,5].map(r=>({value:String(r),label:`${r} ${r===1?`(${t("intensityLow")})`:r===5?`(${t("intensityHigh")})`:""}`}));return e.jsxs(e.Fragment,{children:[e.jsx(H,{isOpen:a&&!E,onClose:m,title:t("newEntry"),children:e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsx(I,{type:"text",label:t("date"),value:o,onChange:ee,error:D.date,placeholder:"DD/MM/AAAA",maxLength:10}),e.jsx(W,{label:t("mood"),value:g,onChange:r=>{c(r.target.value),r.target.value!==O&&(w(""),k(l=>{const{customMood:f,...L}=l;return L}))},options:ae,error:D.mood}),g===O&&e.jsx(I,{type:"text",label:t("moodCustomLabel"),value:b,onChange:r=>{w(r.target.value),r.target.value.trim()&&k(l=>{const{customMood:f,...L}=l;return L})},placeholder:t("moodCustomPlaceholder"),error:D.customMood}),e.jsx(I,{type:"text",label:t("moodDetailLabel"),value:x,onChange:r=>P(r.target.value),placeholder:t("moodDetailPlaceholder"),error:D.moodDetail}),e.jsx(W,{label:t("intensity"),value:String(M),onChange:r=>n(Number(r.target.value)),options:re,error:D.intensity}),e.jsx(V,{label:t("noteOptional"),value:v,onChange:r=>N(r.target.value),placeholder:t("notePlaceholder"),rows:4,error:D.note}),e.jsx(V,{label:t("gratitudeLabel"),value:C,onChange:r=>$(r.target.value),placeholder:t("gratitudePlaceholder"),rows:3,error:D.gratitude}),e.jsx(V,{label:t("prayerRequestLabel"),value:S,onChange:r=>F(r.target.value),placeholder:t("prayerRequestPlaceholder"),rows:3,error:D.prayerRequest}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4",children:[e.jsx(y,{type:"button",variant:"outline",onClick:m,disabled:s.isPending,children:t("cancel")}),e.jsx(y,{type:"submit",isLoading:s.isPending,disabled:s.isPending,children:t("saveEntry")})]}),s.isError&&e.jsx(_.p,{initial:{opacity:0},animate:{opacity:1},className:"text-red-600 text-sm",children:s.error instanceof Error?s.error.message:t("failedToCreateEntry")})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-[60]",children:e.jsxs(H,{isOpen:E,onClose:()=>R(!1),title:t("confirmSave"),footer:e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"outline",onClick:()=>R(!1),disabled:s.isPending,children:t("cancel")}),e.jsx(y,{onClick:te,isLoading:s.isPending,disabled:s.isPending,children:t("confirm")})]}),children:[e.jsx("p",{className:"text-gray-700",children:t("confirmSaveMessage")}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("date"),":"]})," ",o]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("mood"),":"]})," ",g===O?b||t("moodOther"):t(`moods.${g}`)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("intensity"),":"]})," ",M,"/5"]}),C&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("gratitudeLabel"),":"]})," ",C]}),S&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("prayerRequestLabel"),":"]})," ",S]}),v&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[t("note"),":"]})," ",v]})]})]})}),e.jsx(Q,{isOpen:T,onClose:()=>j(!1),message:t("entryCreated"),type:"success"})]})}const J=(a,m)=>A.includes(a)?m(`moods.${a}`):a;function pe({entries:a,onDeleteSuccess:m}){const h=me(),s=[],t=new Date(h.start+"T00:00:00");for(let u=0;u<7;u++){const d=new Date(t);d.setDate(t.getDate()+u);const o=d.toISOString().split("T")[0];s.push({date:o,dayName:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][d.getDay()],entries:a.filter(p=>p.date===o)})}return e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-7 gap-4",children:s.map((u,d)=>e.jsx(je,{day:u,index:d,onDeleteSuccess:m},u.date))})})}function je({day:a,index:m,onDeleteSuccess:h}){const{t:s}=B(),t=X(),[u,d]=i.useState(!1),[o,p]=i.useState(null),{partner1Name:g,partner2Name:c}=Z(),b=n=>n==="Partner 1"?g:n==="Partner 2"?c:n,w=n=>({Happy:"bg-yellow-100 border-yellow-300",Calm:"bg-blue-100 border-blue-300",Anxious:"bg-orange-100 border-orange-300",Sad:"bg-gray-100 border-gray-300",Angry:"bg-red-100 border-red-300",Tired:"bg-purple-100 border-purple-300",Motivated:"bg-green-100 border-green-300"})[n]||"bg-gray-100 border-gray-300",x=n=>{p(n),d(!0)},P=async()=>{if(o)try{await t.mutateAsync(o.id),d(!1),p(null),h()}catch(n){console.error("Failed to delete entry:",n)}},M=a.date===new Date().toISOString().split("T")[0];return e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.05},children:[e.jsx(q,{className:`h-full ${M?"ring-2 ring-primary-500":""}`,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-center border-b border-gray-200 pb-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:s(a.dayName)}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:new Date(a.date+"T00:00:00").getDate()})]}),a.entries.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-gray-400",children:s("noEntryThisDay")})}):e.jsx("div",{className:"space-y-2",children:a.entries.map(n=>e.jsxs("div",{className:`p-2 rounded border-2 ${w(n.mood)} relative group`,children:[e.jsx("button",{onClick:()=>x(n),disabled:t.isPending,className:"absolute -top-2 -right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors opacity-0 group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":s("deleteEntry"),title:s("deleteEntry"),children:e.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-700",children:b(n.user)}),e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[n.intensity,"/5"]})]}),e.jsx("p",{className:"text-xs font-medium text-gray-800",children:J(n.mood,s)}),n.moodDetail&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 italic",children:n.moodDetail}),n.gratitude&&e.jsxs("p",{className:"text-xs text-green-600 mt-1 line-clamp-1",children:["ðŸ™ ",n.gratitude]}),n.prayerRequest&&e.jsxs("p",{className:"text-xs text-purple-600 mt-1 line-clamp-1",children:["âœï¸ ",n.prayerRequest]}),n.note&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:n.note})]},n.id))})]})}),o&&e.jsxs(H,{isOpen:u,onClose:()=>d(!1),title:s("confirmDelete"),footer:e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"outline",onClick:()=>d(!1),disabled:t.isPending,children:s("cancel")}),e.jsx(y,{onClick:P,isLoading:t.isPending,disabled:t.isPending,className:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:t.isPending?s("deleting"):s("deleteEntry")})]}),children:[e.jsx("p",{className:"text-gray-700",children:s("confirmDeleteMessage")}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("date"),":"]})," ",U(o.date)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("mood"),":"]})," ",J(o.mood,s)]}),o.moodDetail&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("moodDetailLabel"),":"]})," ",o.moodDetail]}),o.gratitude&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("gratitudeLabel"),":"]})," ",o.gratitude]}),o.prayerRequest&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("prayerRequestLabel"),":"]})," ",o.prayerRequest]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("intensity"),":"]})," ",o.intensity,"/5"]}),o.note&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("note"),":"]})," ",o.note]})]})]})]})}const K=(a,m)=>A.includes(a)?m(`moods.${a}`):a;function ye(){const[a,m]=i.useState("all"),[h,s]=i.useState(7),[t,u]=i.useState("list"),[d,o]=i.useState(!1),[p,g]=i.useState(!1),{t:c}=B(),{partner1Name:b,partner2Name:w}=Z(),x=z(),M={from:xe(x,-h),to:x,...a!=="all"&&{user:a}},{data:n,isLoading:v,isFetching:N,isError:C,error:$,refetch:S}=de(M);i.useEffect(()=>{S()},[]);const F=async()=>{o(!0);try{await S()}finally{o(!1)}},D=[{value:"all",label:c("allUsers")},{value:"Partner 1",label:b},{value:"Partner 2",label:w}],k=[{value:"7",label:c("last7Days")},{value:"14",label:c("last14Days")},{value:"30",label:c("last30Days")},{value:"90",label:c("last90Days")}],T=n?[...n].sort((j,E)=>E.date.localeCompare(j.date)):[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(W,{label:c("filterByUser"),value:a,onChange:j=>m(j.target.value),options:D})}),e.jsx("div",{className:"flex-1",children:e.jsx(W,{label:c("timePeriod"),value:String(h),onChange:j=>s(Number(j.target.value)),options:k})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("viewMode")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:t==="list"?"primary":"outline",size:"sm",onClick:()=>u("list"),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})}),c("listView")]}),e.jsxs(y,{variant:t==="weekly"?"primary":"outline",size:"sm",onClick:()=>u("weekly"),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),c("weeklyView")]})]})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:F,disabled:d||v||N,className:"sm:self-end",children:[e.jsx("svg",{className:`w-4 h-4 mr-2 ${d||N?"animate-spin":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),c(d||N?"refreshing":"refresh")]})]})]})}),(v||N)&&e.jsx(le,{}),C&&!N&&e.jsx(q,{children:e.jsx(ue,{message:$ instanceof Error?$.message:c("failedToFetchEntries"),onRetry:()=>S()})}),!v&&!N&&!C&&T.length===0&&e.jsx(q,{children:e.jsx(ge,{message:c("noEntriesFound")})}),!v&&!N&&!C&&T.length>0&&e.jsx(e.Fragment,{children:t==="list"?e.jsx("div",{className:"space-y-4",children:T.map((j,E)=>e.jsx(fe,{entry:j,index:E,onDeleteSuccess:()=>g(!0)},j.id))}):e.jsx(pe,{entries:T,onDeleteSuccess:()=>g(!0)})}),e.jsx(Q,{isOpen:p,onClose:()=>g(!1),message:c("entryDeleted"),type:"success"})]})}function fe({entry:a,index:m,onDeleteSuccess:h}){const{t:s}=B(),t=X(),[u,d]=i.useState(!1),{partner1Name:o,partner2Name:p}=Z(),g=x=>x==="Partner 1"?o:x==="Partner 2"?p:x,c=x=>({Happy:"bg-yellow-100 text-yellow-800 border-yellow-200",Calm:"bg-blue-100 text-blue-800 border-blue-200",Anxious:"bg-orange-100 text-orange-800 border-orange-200",Sad:"bg-gray-100 text-gray-800 border-gray-200",Angry:"bg-red-100 text-red-800 border-red-200",Tired:"bg-purple-100 text-purple-800 border-purple-200",Motivated:"bg-green-100 text-green-800 border-green-200"})[x]||"bg-gray-100 text-gray-800 border-gray-200",b=()=>{d(!0)},w=async()=>{try{await t.mutateAsync(a.id),d(!1),h()}catch(x){console.error("Failed to delete entry:",x)}};return e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:m*.05},children:[e.jsxs(q,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:g(a.user)}),e.jsx("p",{className:"text-sm text-gray-600",children:U(a.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium border ${c(a.mood)}`,children:K(a.mood,s)}),e.jsx("button",{onClick:b,disabled:t.isPending,className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":s("deleteEntry"),title:s("deleteEntry"),children:t.isPending?e.jsxs("svg",{className:"w-5 h-5 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s("intensity")}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(x=>e.jsx("div",{className:`h-2 w-full rounded ${x<=a.intensity?"bg-primary-600":"bg-gray-200"}`},x))})]}),a.moodDetail&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-1",children:[s("moodDetailLabel"),":"]}),e.jsx("p",{className:"text-gray-600 italic text-sm",children:a.moodDetail})]}),a.gratitude&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm font-medium text-green-700 mb-1",children:[s("gratitudeLabel"),":"]}),e.jsx("p",{className:"text-green-600 text-sm whitespace-pre-wrap",children:a.gratitude})]}),a.prayerRequest&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm font-medium text-purple-700 mb-1",children:[s("prayerRequestLabel"),":"]}),e.jsx("p",{className:"text-purple-600 text-sm whitespace-pre-wrap",children:a.prayerRequest})]}),a.note&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.note})})]}),e.jsxs(H,{isOpen:u,onClose:()=>d(!1),title:s("confirmDelete"),footer:e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"outline",onClick:()=>d(!1),disabled:t.isPending,children:s("cancel")}),e.jsx(y,{onClick:w,isLoading:t.isPending,disabled:t.isPending,className:"bg-red-600 hover:bg-red-700 focus:ring-red-500",children:t.isPending?s("deleting"):s("deleteEntry")})]}),children:[e.jsx("p",{className:"text-gray-700",children:s("confirmDeleteMessage")}),e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("date"),":"]})," ",U(a.date)]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("mood"),":"]})," ",K(a.mood,s)]}),a.moodDetail&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("moodDetailLabel"),":"]})," ",a.moodDetail]}),a.gratitude&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("gratitudeLabel"),":"]})," ",a.gratitude]}),a.prayerRequest&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("prayerRequestLabel"),":"]})," ",a.prayerRequest]}),e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("intensity"),":"]})," ",a.intensity,"/5"]}),a.note&&e.jsxs("p",{className:"text-sm",children:[e.jsxs("strong",{children:[s("note"),":"]})," ",a.note]})]})]})]})}function Ce(){const{t:a}=B(),[m,h]=i.useState(!1);return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(y,{onClick:()=>h(!0),className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a("addEntry")]})}),e.jsx(ye,{}),e.jsx(he,{isOpen:m,onClose:()=>h(!1)})]})}export{Ce as EntriesPage,oe as useCreateEntry,de as useEntries};
